---
layout: post
title: 网络协议系列4:ed2k链接
date: 2025-05-17 05:00:00 +0800
categories: [网络协议系列]
tags: [网络协议系列]
---
```
ed2k://|file|【人人電影网：www.rrdyw.net】]夜行者.Nightcrawler.2014.BD080P.中英双字.mp4|5360338094|944FF739AD086BB53E7E98F28F4AEA6B|h=M3ZLBKWPVLIV5UY437KW737PNG7ORMC4|/
```
eD2k链接是eDonkey网络协议中用于标识和传输文件的标准化URI格式，其结构设计兼顾了文件唯一性验证和多源下载支持：




所有eD2k链接均以 `ed2k://` 开头，表示使用eDonkey协议处理链接。链接主体通过竖线符号 `|` 分隔不同参数，通用格式为：
```
ed2k://|<类型>|<参数1>|<参数2>|...|/
```



二、核心参数类型及功能
1. **文件链接（File Link）**
最常见的类型，用于标识单个文件：
```
ed2k://|file|<文件名>|<文件大小>|<文件哈希>|/
```
• 文件名：原始文件名（可能包含URL编码的特殊字符）。

• 文件大小：以字节为单位的精确数值（如`3420557312`表示约3.42GB）。

• 文件哈希：基于MD4算法生成的128位哈希值，用于唯一性校验。例如：

  ```
  ed2k://|file|cn_windows_7_ultimate_x64.iso|3420557312|B58548681854236C7939003B583A8078|/
  ```

扩展功能参数：
• 来源地址：添加服务器或主机来源提升下载效率：

  ```
  /|sources,<IP:端口>|/ 或 /|sources,<主机名:端口>|/
  ```
  例如：`ed2k://|file|...|/|sources,202.89.123.6:4662|/`。
• 根哈希（Root Hash）：用于AICH错误校验：

  ```
  |h=<根哈希>|/
  ```
  如：`h=SQ7LUTYUSMDBP2TVE2M7T6VUBLU324KF`。
• HTTP来源：直接通过HTTP协议补充下载源：

  ```
  |s=<HTTP地址>|/
  ```
  例如：`s=http://example.com/file.zip`。

---

2. **服务器链接（Server Link）**
用于连接特定eDonkey服务器：
```
ed2k://|server|<IP>|<端口>|/
```
示例：`ed2k://|server|207.44.222.51|4242|/`。

---

3. **服务器列表链接（Server List Link）**
批量导入服务器列表文件（`server.met`）：
```
ed2k://|serverlist|<HTTP地址>|/
```
如：`ed2k://|serverlist|http://example.com/server.met|/`。

---

4. **其他类型**
• 节点列表链接（Nodes List）：导入Kad网络节点文件`nodes.dat`：

  ```
  ed2k://|nodeslist|<HTTP地址>|/
  ```
• 好友链接（Friend Link）：通过用户哈希添加好友（仅部分客户端支持）：

  ```
  ed2k://|friend|<用户名>|<用户哈希>|/
  ```

---

三、哈希算法机制
eD2k哈希采用 MD4算法变体：
1. 文件被分割为多个9500KB的块（最后一个块可能更小）。
2. 对每个块计算MD4校验值，生成哈希列表。
3. 将哈希列表再次进行MD4运算，生成最终根哈希。  
*注：小于9500KB的文件哈希直接等于其MD4值。*

---

四、应用场景与兼容性
eD2k链接广泛用于eMule、aMule、迅雷等客户端，支持：
• 多源并行下载：通过多个用户或服务器分块传输。

• 断点续传：依赖哈希值验证文件完整性。

